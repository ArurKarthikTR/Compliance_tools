<div [formGroup]="configForm">
  <h2>Test Data Generator</h2>

  <div class="header-controls">
    <div class="rows-input">
      <label for="rowCount">Rows:</label>
      <input 
        type="number" 
        id="rowCount" 
        formControlName="rowCount" 
        min="1" 
        max="1000"
        class="form-control">
    </div>
    <button 
      type="button" 
      class="btn btn-primary generate-btn" 
      (click)="generatePreview()" 
      [disabled]="configForm.invalid || isLoading">
      Generate Data
    </button>
  </div>

  <div *ngIf="fields.length === 0">
    <p class="no-fields-message">No fields added yet. Add a field to start generating data.</p>
  </div>

  <div formArrayName="fields">
    <div class="field-card" *ngFor="let field of fields.controls; let i = index" [formGroupName]="i">
      <div class="field-header">
        <div class="field-name">{{ field.get('name')?.value }}</div>
        <div class="field-actions">
          <span class="field-type">{{ getFieldTypeLabel(field.get('type')?.value) }}</span>
          <button type="button" class="btn btn-duplicate" (click)="duplicateField(i)">Duplicate</button>
        </div>
      </div>
      <div class="field-buttons">
        <button type="button" class="btn btn-edit" (click)="editField(i)">Edit</button>
        <button type="button" class="btn btn-remove" (click)="removeField(i)">Remove</button>
      </div>
    </div>
  </div>

  <button type="button" class="btn btn-add-field" (click)="showFieldForm = true">
    + Add New Field
  </button>

  <div class="add-field-container" *ngIf="showFieldForm">
    <div class="add-field-form">
      <h3>Add New Field</h3>
      
      <form #fieldForm="ngForm">
        <div class="form-group">
          <label for="columnName">Column Name:</label>
          <input 
            type="text" 
            id="columnName" 
            class="form-control" 
            placeholder="Enter column name"
            name="name"
            [(ngModel)]="newField.name" 
            required>
        </div>
        
        <div class="form-group">
          <label for="dataType">Data Type:</label>
          <select 
            id="dataType" 
            class="form-control"
            name="type"
            [(ngModel)]="newField.type">
            <option *ngFor="let type of fieldTypes" [value]="type.value">{{ type.label }}</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Uniqueness:</label>
          <div class="radio-options">
            <div class="radio-option">
              <input 
                type="radio" 
                id="unique" 
                name="unique" 
                [value]="true" 
                [(ngModel)]="newField.unique">
              <label for="unique">Unique</label>
            </div>
            <div class="radio-option">
              <input 
                type="radio" 
                id="duplicate" 
                name="unique" 
                [value]="false" 
                [(ngModel)]="newField.unique">
              <label for="duplicate">Duplicate</label>
            </div>
          </div>
        </div>
      </form>
      
      <div class="form-actions">
        <button type="button" class="btn btn-cancel" (click)="cancelAddField()">Cancel</button>
        <button type="button" class="btn btn-save" (click)="saveNewField()" [disabled]="!fieldForm.valid">Save Field</button>
      </div>
    </div>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger mt-3">
    {{ errorMessage }}
  </div>

  <div *ngIf="successMessage" class="alert alert-success mt-3">
    {{ successMessage }}
  </div>
  
  <div class="preview-container" *ngIf="previewData.length > 0">
    <h3>Data Preview</h3>
    <div class="table-responsive">
      <table class="preview-table">
        <thead>
          <tr>
            <th *ngFor="let header of previewData[0] | keyvalue">{{ header.key }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of previewData">
            <td *ngFor="let cell of row | keyvalue">{{ cell.value }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="download-section" *ngIf="previewData.length > 0">
    <h3>Download Data</h3>
    <div class="download-buttons">
      <button 
        type="button" 
        class="btn btn-download-csv" 
        (click)="downloadData('csv')" 
        [disabled]="isLoading">
        Download as CSV
      </button>
      <button 
        type="button" 
        class="btn btn-download-json" 
        (click)="downloadData('json')" 
        [disabled]="isLoading">
        Download as JSON
      </button>
      <button 
        type="button" 
        class="btn btn-download-xml" 
        (click)="downloadData('xml')" 
        [disabled]="isLoading">
        Download as XML
      </button>
      <button 
        type="button" 
        class="btn btn-download-excel" 
        (click)="downloadData('excel')" 
        [disabled]="isLoading">
        Download as Excel
      </button>
    </div>
  </div>
</div>
